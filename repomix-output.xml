This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

<additional_info>

</additional_info>

</file_summary>

<directory_structure>
services/
  youtube.py
static/
  chat.css
  chat.js
  plan_calendar.js
  plan_intake.js
  script.js
  styles.css
  video_recs.js
templates/
  chatbot.html
  diagnostic.html
  index.html
  learning_styles.html
  results.html
  schedule.html
topic_prompts/
  diagnostic_test.txt
  initial_prompt.txt
  study_plan_prompt.txt
  video_topic_prompt.txt
.gitignore
app.py
c2cbot.code-workspace
diagnostic_test.txt
pyproject.toml
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="static/chat.js">
document.addEventListener('DOMContentLoaded', () => {
  const chatForm = document.getElementById('chat-form');
  const chatInput = document.getElementById('chat-input');
  const chatBox = document.getElementById('chat-box');

  chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const message = chatInput.value.trim();
      if (!message) return;

      appendMessage('You', message);
      chatInput.value = '';

      try {
          const response = await fetch('/chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: message, subject: "General" })
          });

          const data = await response.json();
          appendMessage('AI', data.response || "Error: No response from AI.");
      } catch (error) {
          appendMessage('AI', 'Error: Could not reach server.');
      }
  });

  function appendMessage(sender, text) {
      const messageElement = document.createElement('div');
      messageElement.textContent = `${sender}: ${text}`;
      chatBox.appendChild(messageElement);
      chatBox.scrollTop = chatBox.scrollHeight;
  }
});
</file>

<file path="static/plan_calendar.js">
/* ------------------------------------------------------------
   plan_calendar.js
   â€” render the studyâ€‘plan JSON into a calendar grid, show
     details on click, and expose a â€œRegenerate Planâ€ button
     that dispatches  plan:regenerate.
------------------------------------------------------------ */

(() => {
    const root = document.getElementById("calendar-root");
    if (!root) return console.error("plan_calendar.js âœ #calendar-root not found");
  
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  
    const dayNames   = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
    const monthNames = [
      "January","February","March","April","May","June",
      "July","August","September","October","November","December"
    ];
  
    const safeParse = (txt) => { try { return JSON.parse(txt); } catch { return null; } };
  
    /* convert â€œ5:30pm-7:30pmâ€ â†’ {start:"17:30", end:"19:30"} */
    function splitTimeRange(range) {
      if (!range) return null;
      const [rawStart, rawEnd] = range.split("-").map(s => s.trim());
      if (!rawStart || !rawEnd) return null;
  
      const to24h = (str) => {
        const m = str.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i);
        if (!m) return null;
        let [, h, mm = "00", ap = ""] = m;
        h  = parseInt(h, 10);
        ap = ap.toLowerCase();
        if (ap === "pm" && h !== 12) h += 12;
        if (ap === "am" && h === 12) h  = 0;
        return `${String(h).padStart(2,"0")}:${mm}`;
      };
  
      const start = to24h(rawStart);
      const end   = to24h(rawEnd);
      return start && end ? { start, end } : null;
    }
  
    /**
     * Tryâ€‘hard extractor: returns an **array** of session objects
     * from many possible shapes the backend / LLM might return.
     */
    function extractSessions(plan) {
      if (!plan || typeof plan !== "object") return null;
  
      for (const k of ["sessions","study_plan","days","items"])
        if (Array.isArray(plan[k])) return plan[k];
  
      /* markdownâ€‘wrapped string under plan.raw */
      if (typeof plan.raw === "string") {
        let txt = plan.raw.trim();
        if (txt.startsWith("```")) {
          txt = txt.replace(/^```json\s*/i, "").replace(/```$/i, "").trim();
        }
        const inner = safeParse(txt);
        if (inner) return extractSessions(inner);         // recurse once
      }
      return null;
    }
  
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ calendar renderer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  
    function renderCalendar(plan) {
      const sessionsIn = extractSessions(plan);
  
      if (!sessionsIn) {
        root.innerHTML = `
          <div style="border:1px solid #e74c3c;padding:16px;border-radius:8px;background:#fdecea;color:#c0392b;">
            <p><strong>Oops!</strong> I couldnâ€™t understand the studyâ€‘plan format returned by the server.</p>
            <button class="btn-secondary" id="regen-btn">Regenerate Plan</button>
          </div>`;
        root.querySelector("#regen-btn").onclick =
          () => document.dispatchEvent(new Event("plan:regenerate"));
        return;
      }
  
      /* cache for page refreshes */
      try { localStorage.setItem("latestStudyPlan", JSON.stringify(plan)); } catch { /* ignore quota */ }
  
      /* normalise every item to a common shape */
      const sessions = sessionsIn.map(item => {
        const t = splitTimeRange(item.time || item.timeslot || item.period || "");
        return {
          date:   item.date,
          start:  t?.start || item.start || "?",
          end:    t?.end   || item.end   || "?",
          subject: item.subject || item.content || "",
          label:  item.label || "",
          instructions: item.instructions || item.focus || item.note || "",
          type:   item.type || (item.label ? "test" : "study")
        };
      });
  
      /* group by ISO date */
      const byDate = {};
      sessions.forEach(s => {
        if (s.date) (byDate[s.date] = byDate[s.date] || []).push(s);
      });
  
      /* decide which month to show:
         â€“ earliest sessionâ€™s month, else current month            */
      let baseDate = new Date();
      const allDates = Object.keys(byDate);
      if (allDates.length) {
        allDates.sort();                              // lexicographic â†’ chronological for ISO
        baseDate = new Date(allDates[0] + "T00:00:00");
      }
  
      const month     = baseDate.getMonth();
      const year      = baseDate.getFullYear();
      const firstDay  = new Date(year, month, 1).getDay();
      const daysInMon = new Date(year, month + 1, 0).getDate();
  
      /* header & grid scaffold */
      root.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
          <h2>${monthNames[month]}Â ${year}</h2>
          <button class="btn-secondary" id="regen-btn">Regenerate Plan</button>
        </div>
        <div class="calendar-grid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:8px;"></div>
        <div id="detail-box" style="margin-top:20px;"></div>
      `;
  
      const grid = root.querySelector(".calendar-grid");
      dayNames.forEach(d => {
        const hd = document.createElement("div");
        hd.textContent = d;
        hd.style = "font-weight:bold;text-align:center;";
        grid.appendChild(hd);
      });
  
      for (let i = 0; i < firstDay; i++) grid.appendChild(emptyCell());
  
      for (let d = 1; d <= daysInMon; d++) {
        const iso  = new Date(year, month, d).toISOString().split("T")[0];
        const cell = document.createElement("div");
        cell.className = "day-cell";
        cell.style = "border:1px solid #e0e0e0;min-height:90px;padding:4px;border-radius:6px;cursor:pointer;";
  
        const header = document.createElement("div");
        header.textContent = d;
        header.style = "font-weight:bold;margin-bottom:4px;";
        cell.appendChild(header);
  
        (byDate[iso] || []).forEach(s => {
          const block = document.createElement("div");
          const kind  = s.type === "test" ? "test" : "session";
          block.className = `${kind}-block`;
          block.textContent =
            kind === "test"
              ? (s.label || "Test")
              : `${s.subject || "Study"} â€¢ ${s.start}-${s.end}`;
          block.style = `
            font-size:11px;padding:2px 4px;margin-bottom:2px;border-radius:3px;color:#fff;
            background:${kind === "test" ? "#2ecc71" : "#3498db"};
          `;
          cell.appendChild(block);
        });
  
        cell.addEventListener("click", () => showDetails(iso, byDate[iso] || []));
        grid.appendChild(cell);
      }
  
      root.querySelector("#regen-btn").onclick =
        () => document.dispatchEvent(new Event("plan:regenerate"));
    }
  
    const emptyCell = () => {
      const d = document.createElement("div");
      d.style = "min-height:90px;";
      return d;
    };
  
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ accordion details â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  
    function showDetails(dateISO, sessions) {
      const box = document.getElementById("detail-box");
      if (!sessions.length) {
        box.innerHTML = `<p>No sessions on ${dateISO}</p>`;
        return;
      }
      box.innerHTML = `
        <h3>ğŸ“…Â ${dateISO}</h3>
        <ul style="list-style:disc inside;margin-left:16px;">
          ${sessions.map(s => `
            <li style="margin:6px 0;">
              <strong>${s.start}-${s.end}</strong> â€” ${s.subject || s.label || "Study"}<br>
              <em>${s.instructions || "No details provided."}</em>
            </li>`).join("")}
        </ul>`;
      box.scrollIntoView({ behavior:"smooth" });
    }
  
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ bootstrap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  
    const cached = localStorage.getItem("latestStudyPlan");
    if (cached) {
      try { renderCalendar(JSON.parse(cached)); }
      catch (e) { console.warn("cached plan unreadable", e); }
    }
  
    document.addEventListener("plan:ready", e => renderCalendar(e.detail));
  })();
</file>

<file path="static/plan_intake.js">
/* 
  wizard that gathers:
      â€¢ study goals / subjects
      â€¢ deadlines (label + date list)
      â€¢ weekly availability  â†’ busy & free blocks
    Merges learner profile (window.LEARNER_PROFILE) and POSTs to
    /generate_study_plan.  Emits  plan:ready  with the LLMâ€‘crafted
    plan JSON so plan_calendar.js can render it.

    The wizard also listens for  plan:regenerate  (e.g. user clicks
    â€œRegenerateâ€ on the calendar) and resends the last payload.      */

(() => {
    /* â€‘â€‘â€‘ quick DOM helpers â€‘â€‘â€‘ */
    const $  = (sel, ctx = document) => ctx.querySelector(sel);
    const $$ = (sel, ctx = document) => [...ctx.querySelectorAll(sel)];
    const root = document.getElementById("intake-root");
    if (!root) return console.error("plan_intake.js âœ #intake-root not found");
  
    /* â€‘â€‘â€‘ learner profile (diagnostic summary / learning style) â€‘â€‘â€‘ */
    window.LEARNER_PROFILE = {};            // make globally visible
    let diagnosticSummary = "";             // cached string for wizard display
  
    /* â€‘â€‘â€‘ wizard state â€‘â€‘â€‘ */
    const state = {
      goals: "",
      deadlines: [],                        // {label,date}
      busy : {0: [],1: [],2: [],3: [],4: [],5: [],6: []},
      free : {0: [],1: [],2: [],3: [],4: [],5: [],6: []}
    };
    let currentStep = 0;
    let lastPayload = null;                 // for regenerate shortcut
  
    /* â€‘â€‘â€‘ UI templates for each step â€‘â€‘â€‘ */
    const stepTemplates = [
      /* STEPÂ 1: goals */
      () => `
        <h2>1Â Â·Â Study goals / subjects</h2>
        ${diagnosticSummary
          ? `<div class="diag-summary" style="background:#f0f4ff;border-left:4px solid #4677ff;padding:8px 12px;margin-bottom:12px;">
               <strong>Diagnostic summary:</strong><br>${diagnosticSummary}
             </div>`
          : ""
        }
        <textarea id="goals-input" rows="5"
          placeholder="e.g. AlgebraÂ II chaptersÂ 5â€‘7, score â‰¥Â 85Â % on 15Â May test"
          style="width:100%;"></textarea>
      `,
  
      /* STEPÂ 2: deadlines */
      () => `
        <h2>2Â Â·Â Deadlines & tests</h2>
        <p>Add important dates (exam, quiz, assignment, etc.).</p>
        <div id="deadline-list"></div>
        <button class="btn-secondary" id="add-deadline">+Â Add deadline</button>
      `,
  
      /* STEPÂ 3: availability */
      () => {
        const dayNames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
        return `
          <h2>3Â Â·Â Weekly availability</h2>
          <p>Enter time ranges in 24â€‘hour format â€œHH:MMâ€‘HH:MMâ€. Use commas for multiple blocks.</p>
          <table style="width:100%;border-collapse:collapse;">
            <thead>
              <tr><th></th><th>Busy</th><th>UsuallyÂ FreeÂ (optional)</th></tr>
            </thead>
            <tbody>
              ${dayNames.map((d,i)=>`
                <tr>
                  <td style="padding-right:4px;">${d}</td>
                  <td><input data-day="${i}" data-type="busy" style="width:100%;" placeholder="e.g. 09:00â€‘17:00"></td>
                  <td><input data-day="${i}" data-type="free" style="width:100%;" placeholder="e.g. 18:00â€‘20:00"></td>
                </tr>`).join("")}
            </tbody>
          </table>
        `;
      },
  
      /* REVIEW + submit */
      () => `
        <h2>4Â Â·Â Review & generate</h2>
        <p>Click <strong>Generate Plan</strong> to create your personalised calendar.</p>
        <ul>
          <li><strong>Goals:</strong> ${state.goals || "<em>none</em>"}</li>
          <li><strong>Deadlines:</strong> ${
            state.deadlines.length
              ? state.deadlines.map(d=>`${d.label}Â (${d.date})`).join(", ")
              : "<em>none</em>"
          }</li>
        </ul>
        <button class="btn-primary" id="generate-plan">Generate Plan</button>
      `
    ];
  
    /* â€‘â€‘â€‘ render helper â€‘â€‘â€‘ */
    function renderStep() {
      root.innerHTML = `
        <div class="wizard-box">
          ${stepTemplates[currentStep]()}
          <div style="margin-top:20px;display:flex;justify-content:${currentStep ? "space-between" : "flex-end"}">
            ${currentStep ? '<button class="btn-secondary" id="prev">Back</button>' : ""}
            ${currentStep < stepTemplates.length-1 ? '<button class="btn-primary" id="next">Next</button>' : ""}
          </div>
        </div>
      `;
      attachHandlers();
    }
  
    /* â€‘â€‘â€‘ attach event handlers for current step â€‘â€‘â€‘ */
    function attachHandlers() {
      $("#next")?.addEventListener("click", () => { if (saveStep()) { currentStep++; renderStep(); }});
      $("#prev")?.addEventListener("click", () => { currentStep--; renderStep(); });
  
      /* stepâ€‘specific hooks */
      if (currentStep === 0) {
        $("#goals-input").value = state.goals;
      }
      if (currentStep === 1) {
        const list = $("#deadline-list");
        state.deadlines.forEach(addRow);
        $("#add-deadline").addEventListener("click", () => addRow());
        function addRow(d = { label:"", date:"" }) {
          const row = document.createElement("div");
          row.style = "display:flex;gap:6px;margin:6px 0";
          row.innerHTML = `
            <input placeholder="Label" style="flex:2" value="${d.label}">
            <input type="date"        style="flex:1" value="${d.date}">
            <button class="btn-secondary" title="remove">âœ•</button>`;
          row.querySelector("button").onclick = () => row.remove();
          list.appendChild(row);
        }
      }
      if (currentStep === 2) {
        $$("input[data-day]").forEach(inp => {
          const day = inp.dataset.day, typ = inp.dataset.type;
          inp.value = (state[typ][day] || []).join(", ");
        });
      }
      /* final step */
      $("#generate-plan")?.addEventListener("click", submitWizard);
    }
  
    /* â€‘â€‘â€‘ save inputs of current step into state â€‘â€‘â€‘ */
    function saveStep() {
      if (currentStep === 0) {
        state.goals = $("#goals-input").value.trim();
        return true;
      }
      if (currentStep === 1) {
        const rows = [...$("#deadline-list").children];
        state.deadlines = rows.map(r => {
          const [label, date] = r.querySelectorAll("input");
          return { label: label.value.trim(), date: date.value };
        }).filter(d => d.label && d.date);
        return true;
      }
      if (currentStep === 2) {
        $$("input[data-day]").forEach(inp => {
          const { day, type } = inp.dataset;
          const ranges = inp.value.split(",").map(s => s.trim()).filter(Boolean);
          state[type][day] = ranges;
        });
        return true;
      }
      return true;
    }
  
    /* â€‘â€‘â€‘ build payload & POST to backend â€‘â€‘â€‘ */
    function submitWizard() {
      if (!saveStep()) return;
  
      const payload = {
        diagnostic_summary : window.LEARNER_PROFILE?.diagnostic_summary || "",
        learning_style     : window.LEARNER_PROFILE?.learning_style     || "",
        study_goals        : state.goals,
        deadlines_json     : state.deadlines,
        busy_json          : state.busy,
        free_json          : state.free
      };
      lastPayload = payload;                 // cache for regenerate
  
      root.innerHTML = "<p>â³ Generating your planâ€¦</p>";
  
      fetch("/generate_study_plan", {
        method  : "POST",
        headers : { "Content-Type": "application/json" },
        body    : JSON.stringify(payload)
      })
      .then(r => r.ok ? r.json() : Promise.reject(r))
      .then(data => {
        if (!data.study_plan) throw new Error("No study_plan in response");
        document.dispatchEvent(new CustomEvent("plan:ready", { detail: data.study_plan }));
        root.innerHTML = "";                 // hide wizard
      })
      .catch(err => {
        console.error("Plan generation failed", err);
        root.innerHTML = "<p style='color:red'>Failed to generate plan. Please try again.</p>";
      });
    }
  
    /* â€‘â€‘â€‘ public â€œregenerateâ€ listener â€‘â€‘â€‘ */
    document.addEventListener("plan:regenerate", () => {
      if (lastPayload) {
        fetch("/generate_study_plan", {
          method  : "POST",
          headers : { "Content-Type": "application/json" },
          body    : JSON.stringify(lastPayload)
        })
        .then(r => r.ok ? r.json() : Promise.reject(r))
        .then(data => {
          if (data.study_plan) {
            document.dispatchEvent(new CustomEvent("plan:ready", { detail: data.study_plan }));
          }
        })
        .catch(() => alert("Couldnâ€™t regenerate planÂ â€“ server error."));
      } else {
        currentStep = 0; renderStep();
      }
    });
  
    /* â€‘â€‘â€‘ initialise: fetch learner profile then start wizard â€‘â€‘â€‘ */
    root.innerHTML = "<p>Loading learner profileâ€¦</p>";
    fetch("/get_user_profile")
      .then(r => r.ok ? r.json() : Promise.reject(r))
      .then(data => {
        window.LEARNER_PROFILE  = data || {};
        diagnosticSummary       = data.diagnostic_summary || "";
      })
      .catch(err => {
        console.warn("Could not fetch learner profile:", err);
      })
      .finally(() => {
        renderStep();
      });
  })();
</file>

<file path="static/script.js">
// Wait for the document to load
document.addEventListener('DOMContentLoaded', () => {
    const signInForm = document.getElementById('sign-in-form');
    const signUpForm = document.getElementById('sign-up-form');
  
    if (signInForm) {
      signInForm.addEventListener('submit', (e) => {
        e.preventDefault();
        // Implement sign-in functionality here
        alert('Sign In functionality is not implemented.');
      });
    }
  
    if (signUpForm) {
      signUpForm.addEventListener('submit', (e) => {
        e.preventDefault();
        // Implement sign-up functionality here
        alert('Sign Up functionality is not implemented.');
      });
    }
  });
  
  // Function to toggle modals
  function toggleModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    if (modal.style.display === "flex") {
      modal.style.display = "none";
    } else {
      modal.style.display = "flex";
    }
  }
  
  // Close modal if clicking outside the modal content
  window.onclick = function (event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach((modal) => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });
  };
</file>

<file path="static/video_recs.js">
console.log("__VERSION 6  ::  video_recs.js loaded");

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Mounts on <div id="video-recs-root"> and handles:
//  â€¢ POST â†’ /recommend_videos with diagnostic_summary + learning_style
//  â€¢ Skeleton loader while waiting
//  â€¢ Responsive gallery of video cards (thumbnail + title + channel)
//  â€¢ Inâ€‘page playback with Back button
//  â€¢ "Refresh Videos" button pulls the latest diagnostic summary first
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(() => {
  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ bootstrap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const mount = document.getElementById("video-recs-root");
  if (!mount) return;                         // not on Results page

  const state = {
    videos: [],
    lastPayload: {
      diagnostic_summary: mount.dataset.diagnosticSummary || "",
      learning_style    : mount.dataset.learningStyle     || ""
    }
  };

  renderIntro();

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UI helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  function renderIntro() {
    mount.innerHTML = "";
    if (!state.lastPayload.diagnostic_summary.trim()) {
      mount.innerHTML =
        `<p>Complete a diagnostic test to unlock personalised video recommendations.</p>`;
      return;
    }
    const btn = document.createElement("button");
    btn.className = "btn";
    btn.textContent = "Load Recommended Videos";
    btn.onclick    = loadVideos;
    mount.appendChild(btn);
  }

  function renderSkeleton() {
    mount.innerHTML = "";
    const wrap = document.createElement("div");
    wrap.className = "video-container";
    for (let i = 0; i < 6; i++) {
      const card = document.createElement("div");
      card.className = "video-card";
      card.style =
        "background:#ececec;height:180px;border:none;animation:pulse 1.5s ease-in-out infinite;";
      wrap.appendChild(card);
    }
    mount.appendChild(wrap);

    if (!document.getElementById("pulse-anim")) {
      const style = document.createElement("style");
      style.id = "pulse-anim";
      style.textContent =
        "@keyframes pulse{0%{opacity:.7;}50%{opacity:.4;}100%{opacity:.7;}}";
      document.head.appendChild(style);
    }
  }

  function renderGrid() {
    mount.innerHTML = "";

    // Refresh button
    const refresh = document.createElement("button");
    refresh.className = "btn";
    refresh.textContent = "Refresh Videos";
    refresh.onclick    = loadVideos;      // loadVideos already updates summary
    mount.appendChild(refresh);

    if (!state.videos.length) {
      mount.insertAdjacentHTML(
        "beforeend",
        `<p id="no-videos-message">No videos found for your diagnostic profile.</p>`
      );
      return;
    }

    const grid = document.createElement("div");
    grid.className = "video-container";
    state.videos.forEach(v => {
      const card = document.createElement("div");
      card.className = "video-card";
      card.innerHTML = `
        <div class="video-thumbnail">
          <img src="${v.thumbnail}" alt="${v.title}">
        </div>
        <div class="video-info">
          <h4>${v.title}</h4>
          <p>Channel: ${v.channel}</p>
        </div>`;
      card.querySelector(".video-thumbnail").onclick = () => renderEmbed(v);
      grid.appendChild(card);
    });
    mount.appendChild(grid);
  }

  function renderEmbed(video) {
    mount.innerHTML = "";

    const back = document.createElement("button");
    back.className = "btn";
    back.textContent = "Back to Videos";
    back.onclick     = renderGrid;
    mount.appendChild(back);

    const iframe = document.createElement("iframe");
    iframe.className      = "embedded-video";
    iframe.src            = `https://www.youtube.com/embed/${video.video_id}?autoplay=1`;
    iframe.allow          = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
    iframe.allowFullscreen = true;
    iframe.frameBorder    = "0";
    mount.appendChild(iframe);

    mount.scrollIntoView({ behavior: "smooth" });
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ data helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  // ALWAYS adopt whatever the server returns (even an empty string)
  async function updateDiagnosticSummary() {
    try {
      const profile = await fetch("/get_user_profile").then(r => r.json());
      state.lastPayload.diagnostic_summary = profile.diagnostic_summary ?? "";
      console.log("ğŸ”„ diagnostic_summary now:",
                  state.lastPayload.diagnostic_summary.slice(0, 60) || "(empty)");
    } catch (e) {
      console.warn("Could not refresh diagnostic summary:", e);
    }
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ main fetch routine â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  async function loadVideos () {
    await updateDiagnosticSummary();           // always latest
    console.log("ğŸ“¦ Final payload:", state.lastPayload);

    renderSkeleton();
    fetch(`/recommend_videos?ts=${Date.now()}`, {   // cacheâ€‘bust
      method : "POST",
      headers: { "Content-Type": "application/json" },
      body   : JSON.stringify(state.lastPayload)
    })
    .then(r => r.ok ? r.json() : Promise.reject(r))
    .then(data => {
      console.log("â—€ /recommend_videos â†’", data.videos?.map(v => v.title));
      state.videos = Array.isArray(data.videos) ? data.videos : [];
      renderGrid();
    })
    .catch(err => {
      console.error("/recommend_videos error:", err);
      mount.innerHTML =
        `<p style="color:#c0392b;">Failed to load videos. Please try again later.</p>`;
    });
  }
})();
</file>

<file path="topic_prompts/diagnostic_test.txt">
Your job is only to make 10 diagnostic questions based on the subject and grade level put in by the user.
</file>

<file path="topic_prompts/study_plan_prompt.txt">
System
You are ScholarÂ AI Planner, an expert educational coach who produces concise, calendarâ€‘friendly study sessions.
Always output valid JSON following the â€œstudy_planâ€ schema.

User
Learner profile:
â€¢ Diagnostic strengthsÂ /Â weaknesses: {diagnostic_summary}
â€¢ Preferred learning style: {learning_style}

Study objectives:
â€¢ GoalsÂ /Â subjects: {study_goals}
â€¢ Upcoming deadlines: {deadlines_json}

Availability:
â€¢ Busy blocks (ISO datesÂ +Â HH:MM ranges): {busy_json}
â€¢ Typical free windows: {free_json}

Guidelines:
â€¢ Break content into â‰¤Â 2â€‘hour blocks.  
â€¢ Match study methods to the learning style.  
â€¢ Emphasise weak areas; light review on strengths.  
â€¢ Final 24Â h preâ€‘testÂ =Â recap only.  

Output **only JSON**, never prose.
</file>

<file path="topic_prompts/video_topic_prompt.txt">
System
You are ScholarÂ AI Curator, an expert at mapping student weaknesses to precise YouTube search queries.

User
Diagnostic weaknesses: {weak_areas}
Overall topic: {overall_subject}

Return 3â€“5 concise search queries (â‰¤Â 6Â words each) that would surface the best educational videos for this learner.
Output JSONÂ array only â€“ no prose.
</file>

<file path="c2cbot.code-workspace">
{
	"folders": [
		{
			"path": "."
		}
	],
	"settings": {}
}
</file>

<file path="diagnostic_test.txt">
Directive for ChatBot:
You are tasked with creating a 10 question diagnostic test for a student to see how well they know the specific subject they choose. These questions will be number 1-10 with variance in each question providing either a free response question or a multiple choice question that has 4 answer choices. Each question should be separated by a line break and a dashed line. Your purpose is to create different questions to see what the student knows and what the student doesnâ€™t.
</file>

<file path="pyproject.toml">
[tool.poetry]
name = "python-template"
version = "0.1.0"
description = ""
authors = ["Your Name <you@example.com>"]

[tool.poetry.dependencies]
python = ">=3.10.0,<3.11"
flask = "^3.0.0"
gunicorn = "^21.2.0"
flask-session = "^0.8.0"
openai = "^1.16.1"

[tool.pyright]
# https://github.com/microsoft/pyright/blob/main/docs/configuration.md
useLibraryCodeForTypes = true
exclude = [".cache"]

[tool.ruff]
# https://beta.ruff.rs/docs/configuration/
select = ['E', 'W', 'F', 'I', 'B', 'C4', 'ARG', 'SIM']
ignore = ['W291', 'W292', 'W293']

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"
</file>

<file path="README.md">
# ScholarAI
</file>

<file path="services/youtube.py">
"""wrapper around the YouTube DataÂ APIÂ v3 for fetching educational
video metadata. Designed to be called by /recommend_videos.

Public function:
    search_videos(query: str, max_results: int = 5) -> list[dict]
        Returns a list of { video_id, title, channel, thumbnail }.
"""
from __future__ import annotations

from dotenv import load_dotenv      
load_dotenv()      

import logging
import os
from typing import List, Dict

import requests

logger = logging.getLogger(__name__)

_API_KEY = os.getenv("YOUTUBE_API_KEY")
_SEARCH_URL = "https://www.googleapis.com/youtube/v3/search"

if not _API_KEY:
    logger.warning("YOUTUBE_API_KEY is not set â€“ YouTube searches will fail.")


def _build_params(query: str, max_results: int) -> dict:
    """Build query parameters for the search endpoint."""
    return {
        "part"       : "snippet",
        "q"          : query,
        "type"       : "video",
        "maxResults" : max_results,
        "safeSearch" : "moderate",   # â† relaxed from "strict"
        "key"        : _API_KEY,
    }


def search_videos(query: str, max_results: int = 5) -> List[Dict[str, str]]:
    """Search YouTube for *query* and return a simplified list of results.

    If the API key is missing or an HTTP error occurs, an empty list is
    returned and the issue is logged (so /recommend_videos can degrade
    gracefully rather than crashing).
    """
    if not _API_KEY:
        return []

    try:
        resp = requests.get(
            _SEARCH_URL,
            params=_build_params(query, max_results),
            timeout=8,
        )
        resp.raise_for_status()
        data = resp.json()
    except Exception as exc:  # network / JSON / HTTP errors
        logger.error("YouTube API call failed: %s", exc)
        return []

    results: List[Dict[str, str]] = []
    for item in data.get("items", []):
        vid = item.get("id", {}).get("videoId")
        if not vid:
            continue
        snippet = item.get("snippet", {})
        results.append(
            {
                "video_id" : vid,
                "title"    : snippet.get("title", "(no title)")[:120],
                "channel"  : snippet.get("channelTitle", ""),
                "thumbnail": (
                    snippet.get("thumbnails", {})
                           .get("high", {})
                           .get("url")
                    or snippet.get("thumbnails", {})
                              .get("default", {})
                              .get("url", "")
                ),
            }
        )

    return results
</file>

<file path=".gitignore">
.qodo
.env
</file>

<file path="static/chat.css">
/* Chat Container */
.chat-container {
  background: #f2f2f2;
  border-radius: 12px;
  padding: 20px;
  margin-top: 20px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

/* Chat Log */
.chat-log {
  max-height: 500px;
  overflow-y: auto;
  border: 1px solid #dcdcdc;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 8px;
  background: #ffffff;
}

/* Chat Message */
.chat-message {
  margin-bottom: 12px;
  font-size: 1rem;
  line-height: 1.5;
  font-family: 'Poppins', sans-serif;
}

/* Chat Form */
.chat-form {
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: space-between;
}

/* Chat Input */
#chat-input {
  flex: 3;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-size: 0.95rem;
  min-height: 50px;
  resize: none;
  background: #f5f5f5;
  font-family: 'Poppins', sans-serif;
}

/* Send Button */
.send-button {
  padding: 12px 24px;
  border: none;
  background: #4a90e2;
  color: #fff;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  transition: background 0.3s;
  flex: 1;
  font-family: 'Poppins', sans-serif;
}

.send-button:hover {
  background: #357ab7;
}

/* Chat History */
.chat-history {
  background: #ffffff;
  padding: 15px;
  border-radius: 8px;
  margin-top: 20px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
}

/* Chat Instructions */
.chat-instructions {
  background: #e6e6e6;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
}

.chat-instructions h2 {
  font-size: 1.5rem;
  margin-bottom: 10px;
}

/* Responsive Design */
@media (max-width: 768px) {
  .chat-form {
      flex-direction: column;
  }

  #chat-input {
      width: 100%;
      border-radius: 8px;
  }

  .send-button {
      width: 100%;
      border-radius: 8px;
  }
}
</file>

<file path="templates/results.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ScholarÂ AIÂ â€“Â Results</title>

  <!-- global stylesheet & helpers -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"/>
  <script defer src="{{ url_for('static', filename='script.js') }}"></script>

  <style>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ pageâ€‘specific tweaks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .results-section{background:#f9f9f9;border-radius:8px;padding:20px;margin-bottom:30px;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
    .results-section h3{color:#2c3e50;margin-top:0;border-bottom:1px solid #eee;padding-bottom:10px;}
    #progress-chart{background:#fff;border:1px solid #ddd;border-radius:4px;padding:20px;min-height:200px;display:flex;align-items:center;justify-content:center;}
    .placeholder{color:#999;font-style:italic;}

    /* video galleryÂ â€“ reused by video_recs.js */
    .video-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:20px;}
    .video-card{border:1px solid #ddd;border-radius:8px;overflow:hidden;transition:transform .3s;}
    .video-card:hover{transform:translateY(-5px);box-shadow:0 5px 15px rgba(0,0,0,.1);}
    .video-thumbnail{position:relative;padding-bottom:56.25%;cursor:pointer;}
    .video-thumbnail img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;}
    .video-info{padding:15px;}
    .video-info h4{margin:0 0 10px;font-size:16px;}
    .video-info p{margin:5px 0;font-size:14px;color:#666;}
    .embedded-video{width:100%;aspect-ratio:16/9;margin-bottom:20px;border:none;}
    .btn{display:inline-block;background:#3498db;color:#fff;padding:10px 15px;border-radius:4px;text-decoration:none;margin-top:10px;border:none;cursor:pointer;}
    .btn:hover{background:#2980b9;}
  </style>
</head>
<body>
<header>
  <div class="container">
    <h1>ScholarÂ AI</h1>
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li class="dropdown">
          <a href="javascript:void(0)" class="dropbtn">Tests</a>
          <div class="dropdown-content">
            <a href="/diagnostic">DiagnosticÂ Test</a>
            <a href="/learning_style">LearningÂ Style</a>
          </div>
        </li>
        <li><a href="/chatbot">Chatbot</a></li>
        <li><a href="/schedule">Schedule</a></li>
        <li><a href="/results">Results</a></li>
      </ul>
    </nav>
  </div>
</header>

<section id="results" class="results">
  <div class="container">
    <h2>Your Results</h2>

    <!-- Diagnostic Performance -->
    <!-- DEBUGâ€‘DIAG: {{ diagnostic_analysis|default('EMPTY')|truncate(60) }} -->
    <div id="diagnostic-results" class="results-section">
      <h3>DiagnosticÂ Test Performance</h3>
      <div id="test-results-content">
        {% if diagnostic_analysis %}
          <p>{{ diagnostic_analysis }}</p>
        {% else %}
          <p>No diagnostic test results available. Complete a diagnostic test to see your results.</p>
          <a href="/diagnostic" class="btn">TakeÂ DiagnosticÂ Test</a>
        {% endif %}
      </div>
    </div>

    <!-- Learningâ€‘style -->
    <div id="learning-style-results" class="results-section">
      <h3>LearningÂ Style Assessment</h3>
      <div id="learning-style-content">
        {% if learning_interpretation %}
          <p>{{ learning_interpretation }}</p>
        {% else %}
          <p>No learning style assessment completed. Take the assessment to discover your preferred learning style.</p>
          <a href="/learning_style" class="btn">TakeÂ LearningÂ StyleÂ Assessment</a>
        {% endif %}
      </div>
    </div>

    <!-- Recommended videos -->
    <div id="educational-videos" class="results-section">
      <h3>RecommendedÂ EducationalÂ Videos</h3>
      <div id="video-recs-root"
           data-diagnostic-summary="{{ diagnostic_analysis|default('', true) }}"
           data-learning-style="{{ primary_style|default('', true) }}"></div>
    </div>

    <!-- Progress tracking -->
    <div id="progress-tracking" class="results-section">
      <h3>ProgressÂ OverÂ Time</h3>
      <div id="progress-content">
        <p>Your progress tracking will appear here after multiple assessments.</p>
        <div id="progress-chart">
          <p class="placeholder">Progress chart will be displayed here</p>
        </div>
      </div>
    </div>
  </div>
</section>

<footer>
  <div class="container">
    <p>&copy;Â 2025Â ScholarÂ AI. All rights reserved.</p>
  </div>
</footer>

<!-- modular bundle powering the video recommendations (cacheâ€‘busted) -->
<script type="module" defer
        src="{{ url_for('static', filename='video_recs.js') }}?v=7"></script>
</body>
</html>
</file>

<file path="static/styles.css">
/* Global Styles */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
body {
  font-family: 'Merriweather', serif;
  line-height: 1.6;
  background-color: #f8f9fa;
  color: #2c3e50;
}
.container {
  width: 90%;
  max-width: 1200px;
  margin: auto;
}
/* Header Styles */
header {
  background: #1b2a4e;
  color: #ffffff;
  padding: 25px 0;
}
header .container {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
header h1 {
  font-family: 'Playfair Display', serif;
  margin: 0;
}
nav ul {
  list-style: none;
  display: flex;
}
nav ul li {
  margin: 0 15px;
}
nav ul li a {
  color: #ffffff;
  text-decoration: none;
  font-weight: bold;
  transition: color 0.3s;
}
nav ul li a:hover {
  color: #b0bec5;
}
/* Hero Section */
.hero {
  background: url('https://summer.harvard.edu/wp-content/uploads/sites/7/2022/06/how-to-study-like-a-harvard-student.jpg') no-repeat center center/cover;
  height: 400px;
  display: flex;
  align-items: center;
  text-align: center;
  color: #ffffff;
  position: relative;
  background-position: center;
}
.hero::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(27, 42, 78, 0.7);
  z-index: 1;
}
.hero .container {
  position: relative;
  z-index: 2;
}
.hero h2 {
  font-size: 2.5rem;
  margin-bottom: 10px;
  font-family: 'Playfair Display', serif;
}
.hero p {
  font-size: 1.2rem;
  margin-bottom: 20px;
}
.hero-buttons button {
  background: #546e7a;
  border: none;
  color: #fff;
  padding: 10px 20px;
  margin: 0 10px;
  cursor: pointer;
  font-size: 1rem;
  transition: background 0.3s;
}
.hero-buttons button:hover {
  background: #37474f;
}
/* Features Section */
.features {
  padding: 40px 0;
  background: #ffffff;
  text-align: center;
}
.features h2 {
  margin-bottom: 20px;
  font-family: 'Playfair Display', serif;
}
.feature {
  background: #eceff1;
  padding: 20px;
  margin: 20px;
  display: inline-block;
  width: 250px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}
/* About & Contact Sections */
.about, .contact {
  padding: 40px 0;
  background: #fff;
  text-align: center;
}
.about p{
  margin-bottom: 20px;
}
.about h2, .contact h2 {
  margin-bottom: 20px;
  font-family: 'Playfair Display', serif;
}
/* Footer */
footer {
  background: #1b2a4e;
  color: #fff;
  text-align: center;
  padding: 10px 0;
  margin-top: 20px;
}
/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.5);
  align-items: center;
  justify-content: center;
}
.modal-content {
  background: #fff;
  margin: auto;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 400px;
  position: relative;
  animation: fadeIn 0.3s;
}
.close {
  position: absolute;
  right: 15px;
  top: 10px;
  font-size: 24px;
  cursor: pointer;
}
/* Form Styles */
form input[type="text"],
form input[type="password"] {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border: 1px solid #ddd;
  border-radius: 4px;
}
form button {
  width: 100%;
  background: #1b2a4e;
  color: #fff;
  border: none;
  padding: 10px;
  cursor: pointer;
  border-radius: 4px;
  transition: background 0.3s;
}
form button:hover {
  background: #102040;
}
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* The container <div> - needed to position the dropdown content */
.dropdown {
  position: relative;
  display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

/* Change color of dropdown links on hover */
.dropdown-content a:hover {background-color: #ddd;}

/* Show the dropdown menu on hover */
.dropdown:hover .dropdown-content {display: block;}



.dropdown {
  position: relative;
  display: inline-block;
}

/* Style the dropdown content */
.dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 160px;
  box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
  z-index: 1;
}

/* Show dropdown when hovering over the parent "Tests" button */
.dropdown:hover .dropdown-content,
.dropdown-content:hover {
  display: block;
}

/* Ensure the dropdown container is positioned correctly */
.dropdown {
  position: relative;
  display: inline-block;
}

/* Style the dropdown content */
.dropdown-content {
  display: none;
  position: absolute;
  left: 0;
  top: 100%; /* Make sure it's directly below the button */
  background-color: white;
  min-width: 160px;
  box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
  z-index: 1000;
}

/* Ensure no gap between the button and dropdown */
.dropdown:hover .dropdown-content,
.dropdown-content:hover {
  display: block;
}

/* Optional: Add padding to prevent flickering */
.dropdown-content {
  padding: 5px 0;
}

/* ================================================================== */
/* ===  New styles for Study Planner wizard & calendar (nonâ€‘breaking) */
.wizard-box{
  background:#ffffff;
  padding:25px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
  margin:30px 0;
}
.btn-primary{
  background:#3498db;
  color:#fff;
  padding:10px 20px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  transition:background 0.3s;
}
.btn-primary:hover{background:#2980b9;}
.btn-secondary{
  background:#95a5a6;
  color:#fff;
  padding:10px 20px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  transition:background 0.3s;
}
.btn-secondary:hover{background:#7f8c8d;}
.session-block{
  background:#3498db;
  color:#fff;
  font-size:11px;
  padding:2px 4px;
  border-radius:3px;
  margin-bottom:2px;
  display:block;
}
.test-block{
  background:#2ecc71;
  color:#fff;
  font-size:11px;
  padding:2px 4px;
  border-radius:3px;
  margin-bottom:2px;
  display:block;
}
/* ================================================================== */
</file>

<file path="templates/schedule.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Study Planner | ScholarÂ AI</title>

  <!-- global stylesheet -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"/>

  <style>
    /* --- light, pageâ€‘specific tweaks only --- */
    #learner-summary{
      background:#f5f7fa;
      border-left:4px solid #1b2a4e;
      padding:15px 20px;
      margin:30px 0;
      border-radius:8px;
      font-size:15px;
      line-height:1.5;
    }
    #calendar-root{margin-top:40px;}
  </style>
</head>
<body>
<header>
  <div class="container">
    <h1>ScholarÂ AI</h1>
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li class="dropdown">
          <a href="javascript:void(0)" class="dropbtn">Tests</a>
          <div class="dropdown-content">
            <a href="/diagnostic">Diagnostic Test</a>
            <a href="/learning_style">Learning Style</a>
          </div>
        </li>
        <li><a href="/chatbot">Chatbot</a></li>
        <li><a href="/schedule">Schedule</a></li>
        <li><a href="/results">Results</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="container">
  <!-- learner context (diagnostic + learning style) -->
  <section id="learner-summary">
    <!-- Filled dynamically -->
    <em>Loading your profileâ€¦</em>
  </section>

  <!-- intake wizard mount -->
  <section id="intake-root"></section>

  <!-- calendar mount -->
  <section id="calendar-root"></section>
</main>

<footer>
  <div class="container">
    <p>&copy;Â 2025Â ScholarÂ AI.Â All rights reserved.</p>
  </div>
</footer>

<!-- JS bundles -->
<script type="module" src="{{ url_for('static', filename='plan_intake.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='plan_calendar.js') }}"></script>

<!-- tiny bootstrap script to expose learner profile & summary -->
<script>
/* On load fetch diagnostic summary & learning style once */
fetch("/get_user_profile")
  .then(r => r.ok ? r.json() : Promise.reject())
  .then(data => {
      window.LEARNER_PROFILE = data;            // accessible to modules
      const box=document.getElementById("learner-summary");
      if(!data || Object.keys(data).length===0){
        box.innerHTML="<strong>No profile data yet.</strong> Complete a diagnostic test and learningâ€‘style assessment for best results.";
        return;
      }
      const styleName={
        visual:"Visual",auditory:"Auditory",
        reading_writing:"Reading/Writing",kinesthetic:"Kinesthetic"
      }[data.learning_style]||data.learning_style;
      box.innerHTML=
        `<strong>LearningÂ Style:</strong> ${styleName}<br>`+
        `<strong>DiagnosticÂ Summary:</strong> ${data.diagnostic_summary}`;
  })
  .catch(()=>{document.getElementById("learner-summary").textContent="Unable to load profile data.";});
</script>
</body>
</html>
</file>

<file path="templates/chatbot.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatbot | Scholar AI</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='chat.css') }}">
  <style>
    /* Add these styles to your chat.css file */
    .chat-message {
      margin: 10px 0;
      padding: 12px 16px;
      border-radius: 18px;
      max-width: 80%;
      line-height: 1.4;
    }
    
    .user-message {
      background-color: #e3f2fd;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }
    
    .bot-message {
      background-color: #f1f1f1;
      margin-right: auto;
      border-bottom-left-radius: 4px;
    }
    
    .bot-message p {
      margin: 8px 0;
    }
    
    .bot-message strong {
      font-weight: 600;
      color: #2c3e50;
    }
    
    .bot-message em {
      font-style: italic;
    }
    
    .bot-message ul, .bot-message ol {
      margin: 8px 0;
      padding-left: 24px;
    }
    
    .bot-message code {
      background-color: #f5f5f5;
      padding: 2px 4px;
      border-radius: 4px;
      font-family: monospace;
    }
    
    .bot-message pre {
      background-color: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      margin: 10px 0;
    }
    
    .typing-indicator {
      display: inline-block;
      padding-left: 4px;
    }
    
    .typing-indicator span {
      height: 8px;
      width: 8px;
      background-color: #666;
      border-radius: 50%;
      display: inline-block;
      margin-right: 2px;
      opacity: 0.4;
    }
    
    .typing-indicator span:nth-child(1) {
      animation: typing 1s infinite;
    }
    
    .typing-indicator span:nth-child(2) {
      animation: typing 1s infinite 0.2s;
    }
    
    .typing-indicator span:nth-child(3) {
      animation: typing 1s infinite 0.4s;
    }
    
    @keyframes typing {
      0% { opacity: 0.4; }
      50% { opacity: 1; }
      100% { opacity: 0.4; }
    }

    /* Learning style badge */
    .learning-style-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 14px;
      margin-right: 10px;
      color: black;
      font-weight: 500;
    }

    .badge-visual {
      background-color: #67a973;
    }

    .badge-auditory {
      background-color: #e5a553;
    }

    .badge-reading-writing {
      background-color: #823aa9;
    }

    .badge-kinesthetic {
      background-color: #6bb0d8;
    }

    .chat-status {
      background-color: #f8f9fa;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .status-info {
      color: #2c3e50;
    }

    .status-warning {
      color: #e67e22;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Scholar AI</h1>
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">Tests</a>
            <div class="dropdown-content">
              <a href="/diagnostic">Diagnostic Test</a>
              <a href="/learning_style">Learning Style</a>
            </div>
          </li>
          <li><a href="/chatbot">Chatbot</a></li>
          <li><a href="/schedule">Schedule</a></li>
          <li><a href="/results">Results</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="chat-instructions container">
    <h2>How to Use</h2>
    <p>Welcome to the Scholar AI Chatbot! Type your queries in the input box and press 'Send' to start a conversation with our AI-powered assistant.</p>
    <ul>
      <li>Ask educational questions and get AI-generated responses.</li>
      <li>Use clear and concise language for better responses.</li>
      <li>Format text with **bold**, *italics*, or `code` for better readability.</li>
      <li>Enjoy interactive and engaging learning!</li>
    </ul>
  </section>

  <main class="chat-container container">
    <div id="chat-status" class="chat-status">
      <!-- Status information will be inserted here -->
    </div>
    <div id="chat-box" class="chat-log">
      <!-- Chat messages will appear here -->
    </div>
    <form id="chat-form" class="chat-form">
      <textarea id="chat-input" placeholder="Type your message here..." autocomplete="off" required></textarea>
      <button type="submit" class="send-button">Send</button>
    </form>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 Scholar AI. All rights reserved.</p>
    </div>
  </footer>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const chatForm = document.getElementById('chat-form');
      const chatInput = document.getElementById('chat-input');
      const chatBox = document.getElementById('chat-box');
      const chatStatus = document.getElementById('chat-status');
      
      // Check for learning style and diagnostic test status
      checkStatus();
      
      function checkStatus() {
        const statusMessages = [];
        
        // Check for diagnostic test results
        fetch('/check_diagnostic_status', {
          method: 'GET'
        })
        .then(response => response.json())
        .then(data => {
          if (!data.has_diagnostic) {
            statusMessages.push(`
              <div class="status-warning">
                <strong>Tip:</strong> Take a <a href="/diagnostic">diagnostic test</a> for more personalized assistance.
              </div>
            `);
          }
          
          // Check for learning style
          return fetch('/check_learning_style_status', { method: 'GET' });
        })
        .then(response => response.json())
        .then(data => {
          if (data.has_learning_style) {
            const styleDisplay = {
              'visual': 'Visual',
              'auditory': 'Auditory',
              'reading_writing': 'Reading/Writing',
              'kinesthetic': 'Kinesthetic'
            };
            
            const styleName = styleDisplay[data.learning_style] || data.learning_style;
            const badgeClass = `badge-${data.learning_style}`;
            
            statusMessages.push(`
              <div class="status-info">
                <strong>Learning Style:</strong> 
                <span class="learning-style-badge ${badgeClass}">${styleName}</span>
                Responses will be tailored to your learning style.
              </div>
            `);
          } else {
            statusMessages.push(`
              <div class="status-warning">
                <strong>Tip:</strong> Take the <a href="/learning_style">learning style assessment</a> for customized learning.
              </div>
            `);
          }
          
          // Update status section
          if (statusMessages.length > 0) {
            chatStatus.innerHTML = statusMessages.join('');
            chatStatus.style.display = 'block';
          } else {
            chatStatus.style.display = 'none';
          }
        })
        .catch(error => {
          console.error('Error checking status:', error);
        });
      }
      
      // Function to format the bot's response
      function formatBotResponse(text) {
        // Replace **bold** with <strong>bold</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        // Replace *italics* with <em>italics</em>
        text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
        // Replace `code` with <code>code</code>
        text = text.replace(/`(.*?)`/g, '<code>$1</code>');
        // Replace newlines with <br> and wrap paragraphs in <p>
        text = text.split('\n\n').map(paragraph => {
          if (paragraph.trim() === '') return '';
          return `<p>${paragraph.replace(/\n/g, '<br>')}</p>`;
        }).join('');
        
        return text;
      }
      
      // Function to add a message to the chat
      function addMessage(content, isUser) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${isUser ? 'user-message' : 'bot-message'}`;
        
        if (isUser) {
          messageDiv.textContent = content;
        } else {
          messageDiv.innerHTML = content;
        }
        
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }
      
      // Function to show typing indicator
      function showTypingIndicator() {
        const typingDiv = document.createElement('div');
        typingDiv.className = 'chat-message bot-message typing-indicator';
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = '<span></span><span></span><span></span>';
        chatBox.appendChild(typingDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }
      
      // Function to hide typing indicator
      function hideTypingIndicator() {
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
          typingIndicator.remove();
        }
      }
      
      // Handle form submission
      chatForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const message = chatInput.value.trim();
        if (message === '') return;
        
        // Add user message to chat
        addMessage(message, true);
        chatInput.value = '';
        
        // Show typing indicator
        showTypingIndicator();
        
        // Make real API call to backend
        fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: message, subject: "General" })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          // Hide typing indicator
          hideTypingIndicator();
          
          if (data.error) {
            addMessage(`Error: ${data.error}`, false);
          } else {
            // Format and add bot response
            addMessage(formatBotResponse(data.response), false);
          }
        })
        .catch(error => {
          // Hide typing indicator
          hideTypingIndicator();
          
          console.error('Error:', error);
          addMessage('Sorry, I encountered an error while processing your request. Please try again.', false);
        });
      });
      
      // Allow Shift+Enter for new lines, Enter to submit
      chatInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          chatForm.dispatchEvent(new Event('submit'));
        }
      });
    });
  </script>
</body>
</html>
</file>

<file path="templates/learning_styles.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Learning Style Diagnostic Test | Scholar AI</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  <style>
    /* Main container styling */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Learning styles overview */
    .learning-styles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .style-card {
      background-color: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.3s;
      border-top: 4px solid;
    }
    
    .style-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .style-card h3 {
      margin-top: 0;
      color: #295281;
    }
    
    .style-card p {
      font-size: 14px;
      line-height: 1.5;
      color: #555;
    }
    
    /* Visual style */
    .visual {
      border-color: #67a973;
    }
    
    /* Auditory style */
    .auditory {
      border-color: #e5a553;
    }
    
    /* Reading/Writing style */
    .reading-writing {
      border-color: #823aa9;
    }
    
    /* Kinesthetic style */
    .kinesthetic {
      border-color: #6bb0d8;
    }
    .style-image-container {
    height: 200px; /* Fixed height for consistency */
    overflow: hidden;
    border-radius: 8px;
    margin: 10px 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
    /* Style for the images */
    .style-image {
    width: 100%;
    height: auto;
    object-fit: cover;
    border-radius: 10px;
  }
    
    /* Grid layout for questions */
    .questions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    /* Question card styling */
    .question-card {
      background-color: #f5f7fa;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.2s;
    }
    
    .question-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .question-card p {
      margin-bottom: 15px;
      font-size: 16px;
      line-height: 1.4;
      color: #333;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Compact slider styling */
    .slider-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }
    
    .slider-labels {
      display: flex;
      justify-content: space-between;
      width: 100%;
      margin-bottom: 5px;
      font-size: 12px;
    }
    
    .slider-labels span:first-child { color: #e74c3c; } /* Red for Disagree */
    .slider-labels span:last-child { color: #2ecc71; } /* Green for Agree */
    
    .slider {
      width: 90%;
      height: 8px;
      -webkit-appearance: none;
      background: #e74c3c; /* Start with red (disagree) */
      border-radius: 5px;
      outline: none;
      transition: background 0.2s;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      cursor: pointer;
      border: 2px solid #295281;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    /* Submit button styling */
    .submit-btn {
      display: block;
      margin: 30px auto;
      padding: 12px 30px;
      background-color: #295281;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .submit-btn:hover {
      background-color: #1d3a5f;
    }
    
    /* Result modal styling */
    #result-modal {
      display: none;
      position: fixed;
      z-index: 200;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
    }

    #result-modal h2 {
    color: #295281;
    margin-bottom: 25px;
    font-size: 28px;
    }

    .result-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    }
    .result-image {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 5px solid;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
    #result-modal .modal-content {
    width: 90%;
    max-width: 600px;
    padding: 40px;
    text-align: center;
    border-radius: 15px;
    background: linear-gradient(145deg, #f8f9fa, #ffffff);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    border-top: 5px solid #295281;
    }
    .visual-result { border-color: rgb(121, 223, 164); }
    .auditory-result { border-color: #e1b882; }
    .reading-writing-result { border-color: #a678be; }
    .kinesthetic-result { border-color: #a5c5d7; }

    #result-text {
    font-size: 18px;
    line-height: 1.6;
    color: #333;
    background: #f5f7fa;
    padding: 20px;
    border-radius: 10px;
    border-left: 4px solid #295281;
    }

    #result-details {
    margin-top: 15px;
    font-style: italic;
    color: #555;
    }

    .close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    transition: color 0.3s;
    }

    .close:hover {
    color: #333;
    cursor: pointer;
    }
    #result-modal .close {
      position: absolute;
      right: 20px;
      top: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #777;
    }

    .style-card p {
    font-size: 17px; /* Slightly larger paragraph text */
    line-height: 1.6; /* More spacing between lines */
    color: #444; /* Darker text color for better readability */
    }
    header .container {
      padding: 30px 20px; /* Increased from original */
      margin-bottom: 30px; /* Space below header */
    }

    .modal-content {
       transform: translateY(-20px);
       opacity: 0;
       transition: all 0.3s ease-out;
    }

    .modal-content.animate-in {
       transform: translateY(0);
       opacity: 1;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Loading overlay styles */
    #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 1.5em;
      font-weight: bold;
      z-index: 1000;
      display: none;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid rgba(255, 255, 255, 0.3);
      border-top: 6px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    /* Responsive adjustments */
    @media (max-width: 900px) {
      .questions-grid {
        grid-template-columns: 1fr;
      }
      
      .question-card p {
        min-height: auto;
      }
    }
    
    @media (max-width: 480px) {
      .question-card {
        padding: 15px;
      }
      
      .slider {
        width: 100%;
      }
      
      .learning-styles {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Scholar AI</h1>
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">Tests</a>
            <div class="dropdown-content">
              <a href="/diagnostic">Diagnostic Test</a>
              <a href="/learning_style">Learning Style</a>
            </div>
          </li>
          <li><a href="/chatbot">Chatbot</a></li>
          <li><a href="/schedule">Schedule</a></li>
          <li><a href="/results">Results</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <section>
      <h2>Learning Styles Overview</h2>
      <div class="learning-styles">
        <!-- Visual Learning Style -->
        <div class="style-card visual">
          <h3>Visual Learners</h3>
          <!-- REPLACE THIS IMAGE TAG WITH YOUR VISUAL LEARNING IMAGE -->
          <img src="{{ url_for('static', filename='images/visual.jpg') }}" alt="Visual Learning" class="style-image">
          <p>Learn best through <strong>seeing</strong>. They prefer <strong>diagrams</strong>, <strong>charts</strong>, <strong>pictures</strong>, and <strong>spatial understanding</strong>.</p>
        </div>
        
        <!-- Auditory Learning Style -->
        <div class="style-card auditory">
          <h3>Auditory Learners</h3>
          <!-- REPLACE THIS IMAGE TAG WITH YOUR AUDITORY LEARNING IMAGE -->
          <img src="{{ url_for('static', filename='images/auditory.jpg') }}" alt="Auditory Learning" class="style-image">
          <p>Learn best through <strong>listening</strong>. They benefit from <strong>lectures</strong>, <strong>discussions</strong>, and <strong>verbal explanations</strong>.</p>
        </div>
        
        <!-- Reading/Writing Learning Style -->
        <div class="style-card reading-writing">
          <h3>Reading/Writing Learners</h3>
          <!-- REPLACE THIS IMAGE TAG WITH YOUR READING/WRITING LEARNING IMAGE -->
          <img src="{{ url_for('static', filename='images/reading.jpg') }}" alt="Reading/Writing Learning" class="style-image">
          <p>Learn best through <strong>written words</strong>. They prefer <strong>reading</strong> and <strong>writing</strong> to acquire information.</p>
        </div>
        
        <!-- Kinesthetic Learning Style -->
        <div class="style-card kinesthetic">
          <h3>Kinesthetic Learners</h3>
          <!-- REPLACE THIS IMAGE TAG WITH YOUR KINESTHETIC LEARNING IMAGE -->
          <img src="{{ url_for('static', filename='images/kinesthetic.jpg') }}" alt="Kinesthetic Learning" class="style-image">
          <p>Learn best through <strong>doing</strong>. They prefer <strong>physical activities</strong>, <strong>hands-on tasks</strong>, and <strong>movement</strong>.</p>
        </div>
      </div>
    </section>
    <section>
      <h2>Instructions</h2>
      <p>
        For each statement below, adjust the slider to indicate your level of agreement.
        The left end represents "Disagree" and the right end "Agree." Answer all 20 questions
        honestly to help determine your best learning style.
      </p>
    </section>

    <form id="learning-style-form">
      <div class="questions-grid">
        <!-- Question 1 (Kinesthetic) -->
        <div class="question-card">
          <p>I prefer hands-on learning activities to understand new concepts.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q1" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 2 (Visual) -->
        <div class="question-card">
          <p>I learn best when I use diagrams, charts, or other visual aids.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q2" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 3 (Auditory) -->
        <div class="question-card">
          <p>I remember things better when I hear them rather than when I read them.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q3" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 4 (Reading/Writing) -->
        <div class="question-card">
          <p>I learn best when I take notes or write summaries of what I'm studying.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q4" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 5 (Kinesthetic) -->
        <div class="question-card">
          <p>I enjoy learning through physical movement or role-playing activities.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q5" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 6 (Auditory) -->
        <div class="question-card">
          <p>I learn best by listening to lectures or discussions.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q6" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 7 (Visual) -->
        <div class="question-card">
          <p>I find it easier to understand complex concepts when I see them visually.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q7" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 8 (Reading/Writing) -->
        <div class="question-card">
          <p>I find that writing summaries or lists helps me understand and remember information.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q8" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 9 (Kinesthetic) -->
        <div class="question-card">
          <p>I often remember information better when I can touch or manipulate objects related to the subject.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q9" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 10 (Auditory) -->
        <div class="question-card">
          <p>I prefer to discuss topics with others to understand them.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q10" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 11 (Visual) -->
        <div class="question-card">
          <p>I often use visual aids such as images or videos to support my learning.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q11" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 12 (Reading/Writing) -->
        <div class="question-card">
          <p>I often use written instructions or textbooks to study new topics.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q12" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 13 (Kinesthetic) -->
        <div class="question-card">
          <p>I find it easier to understand instructions if I can perform the task immediately.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q13" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 14 (Auditory) -->
        <div class="question-card">
          <p>I often use my voice to help memorize and process information.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q14" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 15 (Visual) -->
        <div class="question-card">
          <p>I prefer reading materials that include pictures or infographics.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q15" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 16 (Reading/Writing) -->
        <div class="question-card">
          <p>I enjoy taking detailed notes and rewriting them to reinforce my learning.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q16" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 17 (Kinesthetic) -->
        <div class="question-card">
          <p>I enjoy learning through physical activities and interactive experiences.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q17" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 18 (Auditory) -->
        <div class="question-card">
          <p>I find that listening to audio recordings aids my learning.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q18" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 19 (Visual) -->
        <div class="question-card">
          <p>I recall information better when I see it in written or drawn form.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q19" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
        
        <!-- Question 20 (Reading/Writing) -->
        <div class="question-card">
          <p>I enjoy writing out detailed explanations to help myself understand a topic better.</p>
          <div class="slider-container">
            <div class="slider-labels">
              <span>Disagree</span>
              <span>Agree</span>
            </div>
            <input type="range" name="q20" class="slider" min="1" max="100" value="50" required>
          </div>
        </div>
      </div>
      
      <button type="submit" class="submit-btn">Submit Test</button>
    </form>
  </main>

  <!-- Result Modal -->
  <div id="result-modal">
    <div class="modal-content">
      <span class="close" onclick="closeResultModal()">&times;</span>
      <div class="result-content">
        <img id="result-style-image" class="result-image" src="" alt="Learning Style">
        <h2>Your Learning Style</h2>
        <p id="result-text"></p>
        <p id="result-details"></p>
        <div id="result-tips"></div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay">
    <div class="spinner"></div>
    <p id="loading-text">Processing your learning style...</p>
  </div>

  <footer>
    <div class="container">
      <p>&copy; 2025 Scholar AI. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // Update slider appearance based on value
    const sliders = document.querySelectorAll('.slider');
    sliders.forEach(slider => {
      updateSliderStyle(slider);
      slider.addEventListener('input', function() {
        updateSliderStyle(this);
      });
    });
    
    function updateSliderStyle(slider) {
      const val = parseInt(slider.value);
      const red = Math.round(231 - (231 - 46) * (val/100));
      const green = Math.round(76 + (171 - 76) * (val/100));
      const blue = Math.round(60 - (60 - 182) * (val/100));
      slider.style.background = `rgb(${red}, ${green}, ${blue})`;
    }
    
    // Show loading overlay
    function showLoading(message) {
      document.getElementById('loading-text').textContent = message || 'Processing...';
      document.getElementById('loading-overlay').style.display = 'flex';
    }
    
    // Hide loading overlay
    function hideLoading() {
      document.getElementById('loading-overlay').style.display = 'none';
    }
    
    document.getElementById('learning-style-form').addEventListener('submit', function(event) {
      event.preventDefault();
      
      // Calculate scores
      const responses = [];
      for (let i = 1; i <= 20; i++) {
        const value = document.querySelector(`input[name="q${i}"]`).value;
        if (!value) {
          alert('Please answer all questions before submitting.');
          return;
        }
        responses.push(parseInt(value));
      }
      
      const scores = {
        "Visual": responses[1] + responses[5] + responses[9] + responses[13] + responses[17],
        "Auditory": responses[2] + responses[6] + responses[10] + responses[14] + responses[18],
        "Reading/Writing": responses[3] + responses[7] + responses[11] + responses[15] + responses[19],
        "Kinesthetic": responses[0] + responses[4] + responses[8] + responses[12] + responses[16]
      };
      
      const maxScore = Math.max(...Object.values(scores));
      const learnerType = Object.keys(scores).find(key => scores[key] === maxScore);
      
      // Result configuration
      const resultConfig = {
        "Visual": {
          image: "{{ url_for('static', filename='images/visual.jpg') }}",
          colorClass: "visual-result",
          description: "You learn best through visual aids like diagrams, charts, and pictures.",
          tips: ["Use mind maps", "Highlight with colors", "Watch videos"]
        },
        "Auditory": {
          image: "{{ url_for('static', filename='images/auditory.jpg') }}",
          colorClass: "auditory-result",
          description: "You learn most effectively through listening and verbal explanations.",
          tips: ["Record lectures", "Join study groups", "Use mnemonics"]
        },
        "Reading/Writing": {
          image: "{{ url_for('static', filename='images/reading.jpg') }}",
          colorClass: "reading-writing-result",
          description: "You prefer learning through written words and text-based materials.",
          tips: ["Rewrite notes", "Create outlines", "Make flashcards"]
        },
        "Kinesthetic": {
          image: "{{ url_for('static', filename='images/kinesthetic.jpg') }}",
          colorClass: "kinesthetic-result",
          description: "You learn best through hands-on activities and physical experiences.",
          tips: ["Use physical objects", "Take movement breaks", "Build models"]
        }
      };
      
      // Update UI with results
      const result = resultConfig[learnerType];
      document.getElementById("result-style-image").src = result.image;
      document.getElementById("result-style-image").className = `result-image ${result.colorClass}`;
      document.getElementById("result-text").textContent = learnerType;
      document.getElementById("result-details").textContent = result.description;
      
      // Create tips list
      const tipsList = result.tips.map(tip => `<li>${tip}</li>`).join('');
      document.getElementById("result-tips").innerHTML = `
        <h3>Study Tips:</h3>
        <ul>${tipsList}</ul>
      `;
      
      // Convert learning style from display name to backend key
      const styleMap = {
        "Visual": "visual",
        "Auditory": "auditory",
        "Reading/Writing": "reading_writing",
        "Kinesthetic": "kinesthetic"
      };
      
      // Prepare API request data
      const apiData = {
        visual: scores["Visual"],
        auditory: scores["Auditory"],
        reading_writing: scores["Reading/Writing"],
        kinesthetic: scores["Kinesthetic"]
      };
      
      // Show loading animation
      showLoading('Saving your learning style...');
      
      // Send data to backend
      fetch('/submit_learning_style', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(apiData)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        hideLoading();
        
        // Show modal with animation
        document.getElementById("result-modal").style.display = "flex";
        setTimeout(() => {
          document.querySelector(".modal-content").classList.add("animate-in");
          
          // Add a button to view detailed results
          setTimeout(() => {
            // After showing results, give the option to navigate to results page
            const viewResultsBtn = document.createElement('button');
            viewResultsBtn.className = 'submit-btn';
            viewResultsBtn.style.marginTop = '20px';
            viewResultsBtn.textContent = 'View Detailed Results';
            viewResultsBtn.onclick = function() {
              window.location.href = '/results';
            };
            document.querySelector('.result-content').appendChild(viewResultsBtn);
          }, 1000);
        }, 10);
      })
      .catch(error => {
        console.error('Error saving learning style:', error);
        hideLoading();
        alert('There was an error saving your learning style. Please try again.');
      });
    });
    
    function closeResultModal() {
      document.querySelector(".modal-content").classList.remove("animate-in");
      setTimeout(() => {
        document.getElementById("result-modal").style.display = "none";
      }, 300);
    }
    
    window.onclick = function(event) {
      if (event.target === document.getElementById("result-modal")) {
        closeResultModal();
      }
    };
  </script>
</body>
</html>
</file>

<file path="templates/diagnostic.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagnostic Test | Scholar AI</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='chat.css') }}">
  <style>
    /* Loading overlay styles */
    #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 1.5em;
      font-weight: bold;
      z-index: 1000;
      display: none;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid rgba(255, 255, 255, 0.3);
      border-top: 6px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    /* Question and answer styling */
    .question-answer-pair {
      margin-bottom: 30px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    
    .question-text {
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 1.1em;
    }
    
    .answer-choices {
      margin-bottom: 15px;
      padding-left: 20px;
    }
    
    .answer-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1em;
    }
    
    #answers-form {
      margin-top: 20px;
    }
    
    #questions-container {
      counter-reset: question-counter;
    }
    
    .question-text:before {
      counter-increment: question-counter;
      content: "Question " counter(question-counter) ": ";
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Scholar AI</h1>
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">Tests</a>
            <div class="dropdown-content">
              <a href="/diagnostic">Diagnostic Test</a>
              <a href="/learning_style">Learning Style</a>
            </div>
          </li>
          <li><a href="/chatbot">Chatbot</a></li>
          <li><a href="/schedule">Schedule</a></li>
          <li><a href="/results">Results</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="chat-container container">
    <div id="diagnostic-test-section">
      <h2>Generate a Diagnostic Test</h2>
      <form id="generate-test-form">
        <label for="subject">Subject:</label>
        <input type="text" id="subject" placeholder="Enter subject (e.g., Mathematics)" required>

        <label for="grade-level">Grade Level:</label>
        <input type="text" id="grade-level" placeholder="Enter grade level (e.g., 7)" required>

        <label for="topic">Topic:</label>
        <input type="text" id="topic" placeholder="Enter topic (e.g., Algebra)" required>

        <button type="submit">Generate Test</button>
      </form>

      <!-- Answers Form (hidden until test is generated) -->
      <form id="answers-form" style="display:none;">
        <h3>Diagnostic Test</h3>
        <p>Please answer each question below:</p>
        <div id="questions-container"></div>
        <button type="submit">Submit Answers</button>
      </form>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 Scholar AI. All rights reserved.</p>
    </div>
  </footer>

  <!-- Loading Overlay -->
  <div id="loading-overlay">
    <div class="spinner"></div>
    <p id="loading-text">Generating Test...</p>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const generateForm = document.getElementById('generate-test-form');
      const answersForm = document.getElementById('answers-form');
      const questionsContainer = document.getElementById('questions-container');
      const loadingOverlay = document.getElementById('loading-overlay');
      const loadingText = document.getElementById('loading-text');

      generateForm.addEventListener('submit', function(event) {
        event.preventDefault();

        const subject = document.getElementById('subject').value.trim();
        const gradeLevel = document.getElementById('grade-level').value.trim();
        const topic = document.getElementById('topic').value.trim();

        loadingText.textContent = "Generating Test...";
        loadingOverlay.style.display = "flex";

        fetch('/generate_test', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            subject: subject,
            grade_level: gradeLevel,
            topic: topic
          })
        })
        .then(response => response.json())
        .then(data => {
          loadingOverlay.style.display = "none";

          if (data.diagnostic_test) {
            createQuestionAnswerPairs(data.diagnostic_test);
            answersForm.style.display = 'block';
            document.querySelector('.question-answer-pair')?.scrollIntoView({ behavior: 'smooth' });
          } else if (data.error) {
            alert(data.error);
          }
        })
        .catch(error => {
          console.error('Error generating test:', error);
          alert('An error occurred while generating the test.');
          loadingOverlay.style.display = "none";
        });
      });

      answersForm.addEventListener('submit', function(e) {
        e.preventDefault();

        loadingText.textContent = "Submitting Answers...";
        loadingOverlay.style.display = "flex";

        const answers = {};
        document.querySelectorAll('.answer-input').forEach((input, index) => {
          answers[`answer${index + 1}`] = input.value;
        });

        fetch('/submit_test', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(answers)
        })
        .then(response => response.json())
        .then(data => {
          loadingOverlay.style.display = "none";
          if (data.status === 'ok') {
            alert('Answers submitted successfully!');
          } else {
            alert('Error submitting answers.');
          }
        })
        .catch(err => {
          console.error('Error submitting answers:', err);
          alert('Submission error occurred.');
          loadingOverlay.style.display = "none";
        });
      });
      
      function createQuestionAnswerPairs(testContent) {
        questionsContainer.innerHTML = '';
        
        // Split by double newlines to separate questions
        const rawQuestions = testContent.split(/\n\n+/);
        let questionCount = 0;
        
        rawQuestions.forEach((rawQuestion) => {
          if (questionCount >= 10) return;
          
          const lines = rawQuestion.split('\n').filter(line => line.trim() !== '');
          if (lines.length === 0) return;
          
          const questionText = lines[0];
          const answerChoices = lines.slice(1);
          
          if (questionText && questionText.trim() !== '') {
            questionCount++;
            createQuestionElement(questionCount, questionText, answerChoices);
          }
        });
      }
      
      function createQuestionElement(number, questionText, answerChoices) {
        const pairDiv = document.createElement('div');
        pairDiv.className = 'question-answer-pair';
        
        const questionEl = document.createElement('div');
        questionEl.className = 'question-text';
        questionEl.textContent = questionText;
        
        pairDiv.appendChild(questionEl);
        
        if (answerChoices.length > 0) {
          const choicesEl = document.createElement('div');
          choicesEl.className = 'answer-choices';
          
          answerChoices.forEach(choice => {
            const choiceEl = document.createElement('div');
            choiceEl.textContent = choice;
            choicesEl.appendChild(choiceEl);
          });
          
          pairDiv.appendChild(choicesEl);
        }
        
        const answerInput = document.createElement('input');
        answerInput.type = 'text';
        answerInput.className = 'answer-input';
        answerInput.required = true;
        answerInput.placeholder = answerChoices.length > 0 ? 
          'Enter your choice (A, B, C, D) or answer' : 
          'Type your answer here...';
        
        pairDiv.appendChild(answerInput);
        questionsContainer.appendChild(pairDiv);
      }
    });
  </script>
</body>
</html>
</file>

<file path="topic_prompts/initial_prompt.txt">
You are Scholar AI, an intelligent and adaptive tutoring assistant designed to help students learn effectively.

Your primary tasks are to:
1. Analyze diagnostic test results to identify strengths and weaknesses
2. Provide personalized feedback and guidance based on the student's learning style
3. Create customized study plans that respect the student's schedule and abilities

When a student first contacts you, ALWAYS begin by analyzing their existing diagnostic test results if available. Do not ask "which subject would you like to study" or similar questions if test results are already in the context. Instead, immediately provide helpful feedback on their performance.

If a student explicitly asks about a new subject or topic, you can then switch to that subject.

Role & Purpose:
You are an AI Scholar, an intelligent and adaptive tutoring assistant designed to help students diagnose their weaknesses, create study schedules, and provide targeted learning resources. Your goal is to identify student strengths and weaknesses through diagnostic tests and generate personalized study plans that fit their learning style and schedule.

Core Functionality:
1. Diagnostic Analysis
Analyze the student's completed diagnostic test results.
Provide clear explanation of:
- Which questions they answered correctly
- Where they made mistakes and why
- Patterns in their knowledge gaps
- Recommended areas to focus on

2. Learning Style Adaptation
Customize your explanations based on the student's identified learning style:
- Visual learners: Use diagrams, charts, and spatial descriptions
- Auditory learners: Emphasize verbal explanations and discussion-based approaches
- Reading/Writing learners: Provide structured text explanations, lists, and written resources
- Kinesthetic learners: Relate concepts to physical activities and real-world applications

3. Personalized Guidance
Provide actionable next steps for improvement:
- Specific study techniques aligned with their learning style
- Resource recommendations (videos, practice problems, readings)
- Time management suggestions
- Motivation and encouragement

Behavioral Guidelines:
- Be supportive and encouraging, never judgmental about mistakes
- Explain concepts clearly and at the appropriate level
- Adapt to the student's pace and needs
- Balance depth with accessibility
- Focus on practical advice they can implement immediately
</file>

<file path="templates/index.html">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scholar AI</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  <script defer src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1>Scholar AI</h1>
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">Tests</a>
            <div class="dropdown-content">
              <a href="/diagnostic">Diagnostic Test</a>
              <a href="/learning_style">Learning Style</a>
            </div>
          </li>
          <li><a href="/chatbot">Chatbot</a></li>
          <li><a href="/schedule">Schedule</a></li>
          <li><a href="/results">Results</a></li>
        </ul>
      </nav>
    </div>
  </header>
  <section id="hero" class="hero">
    <div class="container">
      <h2>AI-Powered Learning for Everyone</h2>
      <p>Enhance your teaching and learning experience with Scholar AI.</p>
    </div>
  </section>
  <section id="features" class="features">
    <div class="container">
      <h2>Key Features</h2>
      <div class="feature">
        <h3>Student Analytics</h3>
        <p>Track and improve student performance with AI insights.</p>
      </div>
      <div class="feature">
        <h3>Interactive AI Tutor</h3>
        <p>Get real-time assistance with AI-powered tutoring.</p>
      </div>
      <div class="feature">
        <h3>Lesson Planning</h3>
        <p>AI-generated lesson plans tailored to your needs.</p>
      </div>
      
    </div>
  </section>
  <section id="about" class="about">
    <div class="container">
      <h2>About Scholar AI</h2>
      <p>Scholar AI leverages cutting-edge artificial intelligence to enhance educational experiences for both teachers and students.</p>
      <p></p>
      <p>To utilize ScholarAI make sure to head to the diagnostic page before getting feadback from our AI.</p>
    </div>
  </section>
  <section id="contact" class="contact">
    <div class="container">
      <h2>Contact Us</h2>
      <p>
        Have questions or need assistance? Reach out to us at
        <a href="mailto:support@scholarai.com">support@scholarai.com</a>.
      </p>
    </div>
  </section>
  <footer>
    <div class="container">
      <p>&copy; 2025 Scholar AI. All rights reserved.</p>
    </div>
  </footer>
</body>
</html>
</file>

<file path="app.py">
from __future__ import annotations

from dotenv import load_dotenv 
load_dotenv()      

import json
import logging
import os
from datetime import datetime
from typing import Any, Dict, List

import openai
from flask import Flask, jsonify, render_template, request, session
from flask_session import Session


from services.youtube import search_videos

app = Flask(__name__)

# --------------------- Configuration ---------------------

app.config["SESSION_PERMANENT"] = False
app.config["SESSION_TYPE"] = "filesystem"
Session(app)

# Force the logger to show INFO level messages
app.logger.setLevel(logging.INFO)

# put api key here 
openai.api_key = os.getenv("OPENAI_API_KEY")
# --------------------- Helper Functions ---------------------


def _read_prompt_template(template_path: str) -> str:
    """
    Read a prompt template file, guaranteeing the directory exists.
    """
    os.makedirs(os.path.dirname(template_path), exist_ok=True)
    if not os.path.exists(template_path):
        # create an empty template stub so devs notice
        with open(template_path, "w") as f:
            f.write("# prompt template placeholder\n")
    with open(template_path, "r") as f:
        return f.read()


def _safe_json_loads(text: str):
    """
    Attempt to parse a JSON string, returning None if it fails.
    """
    try:
        return json.loads(text)
    except Exception:
        return None


# --------------------- Routes ---------------------


@app.route("/")
def home():
    return render_template("index.html")


@app.route("/diagnostic")
def diagnostic():
    # Renders the page where users can generate and answer a 10-question diagnostic
    return render_template("diagnostic.html")


@app.route("/results")
def results():
    # Diagnostic results
    diagnostic_analysis = session.get("latest_diagnostic_analysis", "")
    test_questions = session.get("latest_diagnostic_test", "")
    test_answers = session.get("latest_test_answers", {})

    # Learning style results
    learning_style_scores = session.get("learning_style_scores", {})
    learning_interpretation = session.get("learning_style_interpretation", "")
    primary_style = session.get("primary_learning_style", "")

    return render_template(
        "results.html",
        diagnostic_analysis=diagnostic_analysis,
        test_questions=test_questions,
        test_answers=test_answers,
        learning_scores=learning_style_scores,
        learning_interpretation=learning_interpretation,
        primary_style=primary_style,
    )


@app.route("/check_diagnostic_status", methods=["GET"])
def check_diagnostic_status():
    """Check if user has completed a diagnostic test"""
    has_diagnostic = "latest_test_answers" in session and session["latest_test_answers"]
    return jsonify({"has_diagnostic": bool(has_diagnostic)})


@app.route("/check_learning_style_status", methods=["GET"])
def check_learning_style_status():
    """Check if user has completed the learning style assessment"""
    has_learning_style = (
        "primary_learning_style" in session and session["primary_learning_style"]
    )
    learning_style = session.get("primary_learning_style", "")
    return jsonify(
        {"has_learning_style": bool(has_learning_style), "learning_style": learning_style}
    )


@app.route("/get_user_profile", methods=["GET"])
def get_user_profile():
    """
    Provide the frontâ€‘end with a lightweight learner profile
    consisting of diagnostic summary and primary learning style.
    """
    diagnostic_summary = session.get("latest_diagnostic_analysis", "")
    learning_style = session.get("primary_learning_style", "")
    return jsonify(
        {
            "diagnostic_summary": diagnostic_summary,
            "learning_style": learning_style,
        }
    )


@app.route("/submit_learning_style", methods=["POST"])
def submit_learning_style():
    data = request.get_json()
    if not data:
        return jsonify({"error": "No data received"}), 400

    try:
        # Store raw scores
        session["learning_style_scores"] = {
            "visual": data.get("visual", 0),
            "auditory": data.get("auditory", 0),
            "reading_writing": data.get("reading_writing", 0),
            "kinesthetic": data.get("kinesthetic", 0),
        }

        # Determine primary learning style
        max_score = max(session["learning_style_scores"].values())
        primary_style = [
            k for k, v in session["learning_style_scores"].items() if v == max_score
        ][0]

        # Generate a detailed interpretation
        interpretation_prompt = (
            f"Student's learning style scores:\n"
            f"Visual: {session['learning_style_scores']['visual']}\n"
            f"Auditory: {session['learning_style_scores']['auditory']}\n"
            f"Reading/Writing: {session['learning_style_scores']['reading_writing']}\n"
            f"Kinesthetic: {session['learning_style_scores']['kinesthetic']}\n\n"
            f"The primary learning style is {primary_style}.\n"
            "Provide a 3-4 paragraph interpretation of these results, including:\n"
            "1. What this learning style means\n"
            "2. Study strategies that would be effective\n"
            "3. Potential challenges and how to overcome them\n"
            "Use simple, clear language suitable for students."
        )

        response = openai.chat.completions.create(
            model="gpt-4o",
            messages=[{"role": "user", "content": interpretation_prompt}],
            temperature=0.7,
            max_tokens=500,
        )

        if response.choices:
            session["learning_style_interpretation"] = (
                response.choices[0].message.content
            )
            session["primary_learning_style"] = primary_style
        else:
            session["learning_style_interpretation"] = "Interpretation unavailable"

        return jsonify(
            {
                "status": "success",
                "primary_style": primary_style,
                "interpretation": session["learning_style_interpretation"],
            }
        )

    except Exception as e:
        app.logger.error(f"Error processing learning style: {e}")
        return jsonify({"error": str(e)}), 500


@app.route("/chatbot")
def chatbot_page():
    # Renders the chatbot page where users can ask questions
    return render_template("chatbot.html")


@app.route("/learning_style")
def learning_style():
    # Renders the page for the VARK learning style assessment
    return render_template("learning_styles.html")


@app.route("/schedule")
def schedule():
    # Renders the weekly schedule/planner
    return render_template("schedule.html")


# ---------------- Study Planner (AI calendar) endpoints -----------------


@app.route("/generate_study_plan", methods=["POST"])
def generate_study_plan():
    """
    Accepts JSON payload from the intake wizard and returns a
    JSON study plan produced by the LLM.
    """
    data = request.get_json() or {}
    try:
        # read & format prompt template
        template_path = "topic_prompts/study_plan_prompt.txt"
        template = _read_prompt_template(template_path)
        filled_prompt = template.format(
            diagnostic_summary=data.get("diagnostic_summary", ""),
            learning_style=data.get("learning_style", ""),
            study_goals=data.get("study_goals", ""),
            deadlines_json=json.dumps(data.get("deadlines_json", [])),
            busy_json=json.dumps(data.get("busy_json", {})),
            free_json=json.dumps(data.get("free_json", {})),
        )

        app.logger.info("=== Generating Study Plan ===")
        response = openai.chat.completions.create(
            model="gpt-4o",
            messages=[
                {
                    "role": "system",
                    "content": "You are ScholarÂ AI Planner, an expert educational coach.",
                },
                {"role": "user", "content": filled_prompt},
            ],
            temperature=0.5,
            max_tokens=1500,
        )

        if not response.choices:
            raise RuntimeError("No choices returned from OpenAI")

        raw_plan = response.choices[0].message.content.strip()
        parsed_plan = _safe_json_loads(raw_plan) or {"raw": raw_plan}

        # unwrap nested plan if LLM wrapped it
        if isinstance(parsed_plan, dict) and "study_plan" in parsed_plan:
            parsed_plan = parsed_plan["study_plan"]

        # store a copy so user sees it on refresh
        session["latest_study_plan"] = parsed_plan

        return jsonify({"study_plan": parsed_plan})

    except Exception as e:
        app.logger.error(f"Error generating study plan: {e}")
        return jsonify({"error": str(e)}), 500


# ---------------- Existing diagnostic & chat endpoints -----------------


@app.route("/generate_test", methods=["POST"])
def generate_test():
    """
    Generate a 10-question diagnostic test based on user input
    and store it in session for later analysis.
    """
    data = request.get_json() or {}
    subject = data.get("subject", "General")
    grade_level = data.get("grade_level", "Unknown")
    topic = data.get("topic", "")

    system_prompt = (
        "You are an expert curriculum developer. "
        "Create a 10â€‘question diagnostic test mixing multipleâ€‘choice (Aâ€“D) and short freeâ€‘response questions. "
        "Format each question on a new line."
    )

    user_prompt = (
        f"Subject: {subject}\n"
        f"Grade Level: {grade_level}\n"
        f"Topic: {topic}\n\n"
        "Generate exactly 10 diagnostic questions."
    )

    try:
        app.logger.info("=== Generating Diagnostic Test ===")
        response = openai.chat.completions.create(
            model="gpt-4o",
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": user_prompt},
            ],
            temperature=0.7,
            max_tokens=1000,
        )

        diagnostic_test_text = (
            response.choices[0].message.content.strip()
            if response.choices
            else "[No content returned by OpenAI]"
        )
        session["latest_diagnostic_test"] = diagnostic_test_text
        return jsonify({"diagnostic_test": diagnostic_test_text})

    except Exception as e:
        app.logger.error(f"Error generating test: {e}")
        return jsonify({"error": str(e)}), 500


@app.route("/submit_test", methods=["POST"])
def submit_test():
    answers = request.get_json() or {}
    session["latest_test_answers"] = answers

    # â‘  immediately wipe the old summary so nothing stale can leak through
    session["latest_diagnostic_analysis"] = "(pending)"   #  <<< NEW
    session.modified = True                                #  <<< NEW

    diagnostic_test_text = session.get("latest_diagnostic_test", "")
    try:
        if diagnostic_test_text:
            summary_prompt = (
                "Below is a diagnostic test followed by the student's answers.\n"
                "Write a concise 3â€‘4 sentence summary â€¦"
            )
            resp = openai.chat.completions.create(
                model="gpt-4o",
                messages=[{"role": "user", "content": summary_prompt}],
                temperature=0.5,
                max_tokens=250,
            )
            summary_text = resp.choices[0].message.content.strip() if resp.choices else ""
        else:
            summary_text = "Diagnostic summary unavailable (test text missing)."
    except Exception as e:
        app.logger.error(f"Diagnostic summary generation failed: {e}")
        summary_text = "Diagnostic summary unavailable due to an error."

    # â‘¡ alwaysÂ â€”Â even on failureÂ â€”Â store *something* new
    session["latest_diagnostic_analysis"] = summary_text
    app.logger.info("â˜‘ï¸  latest_diagnostic_analysis set to: %s",
                    summary_text[:120])

    return jsonify({"status": "ok"})


@app.route("/chat", methods=["POST"])
def chat():
    """
    Primary chatbot endpoint. Sends diagnostic context + learning style
    plus conversation to the LLM, then returns the reply.
    """
    data = request.json or {}
    user_message = data.get("message", "")
    subject = data.get("subject", "General Knowledge")

    if "conversation" not in session:
        session["conversation"] = []

    if user_message:
        session["conversation"].append({"role": "user", "content": user_message})

    diagnostic_test_text = session.get("latest_diagnostic_test", "")
    test_answers = session.get("latest_test_answers", {})
    primary_learning_style = session.get("primary_learning_style", "")
    learning_style_scores = session.get("learning_style_scores", {})

    # ---------------- build system message ----------------
    text_file_path = "topic_prompts/initial_prompt.txt"
    os.makedirs(os.path.dirname(text_file_path), exist_ok=True)
    if not os.path.exists(text_file_path):
        with open(text_file_path, "w") as file:
            file.write(
                "You are Scholar AI, an intelligent tutoring assistant. "
                "Evaluate the student's diagnostic test answers below, identify correctness or mistakes, "
                "and provide detailed feedback and next steps.\n"
            )

    with open(text_file_path, "r") as file:
        initial_prompt = file.read()

    system_content = (
        initial_prompt + f"\n\nStudent has chosen the subject: {subject}\n\n"
        "IMPORTANT: When a user first messages you or asks for help studying, "
        "DO NOT ask generic questions about what subject they want to study. "
        "Instead, immediately use the diagnostic test results and learning style information "
        "provided below to offer personalized guidance. Assume they want help with the "
        "material covered in their diagnostic test unless they specifically ask for something else.\n\n"
    )

    if diagnostic_test_text and test_answers:
        system_content += "=== Diagnostic Test ===\n"
        system_content += diagnostic_test_text + "\n\n"
        system_content += "=== Student's Answers ===\n"
        for key, val in test_answers.items():
            system_content += f"{key}: {val}\n"
        system_content += "\n"

    if primary_learning_style:
        system_content += "=== Student's Learning Style ===\n"
        system_content += f"Primary Learning Style: {primary_learning_style}\n"
        if learning_style_scores:
            system_content += "Scores:\n"
            for style, score in learning_style_scores.items():
                system_content += f"- {style}: {score}\n"
        system_content += "\n"

        if primary_learning_style == "visual":
            system_content += (
                "- Use diagrams, charts, and images in explanations\n"
                "- Suggest visual study aids like mind maps and color coding\n"
                "- Describe concepts with visual metaphors and spatial relationships\n"
            )
        elif primary_learning_style == "auditory":
            system_content += (
                "- Explain concepts as if speaking them aloud\n"
                "- Suggest verbal repetition and discussion-based learning\n"
                "- Recommend audio recordings and verbal mnemonics\n"
            )
        elif primary_learning_style == "reading_writing":
            system_content += (
                "- Structure information in written format with lists and paragraphs\n"
                "- Suggest note-taking and written summaries as study techniques\n"
                "- Emphasize the importance of text-based learning resources\n"
            )
        elif primary_learning_style == "kinesthetic":
            system_content += (
                "- Relate concepts to physical experiences and real-world applications\n"
                "- Suggest hands-on activities and practice-based learning\n"
                "- Recommend movement and physical interaction while studying\n"
            )

    if diagnostic_test_text and test_answers:
        system_content += (
            "ALWAYS start by analyzing the diagnostic test results when the conversation begins "
            "or when the user asks for help studying. Evaluate these answers for correctness, "
            "identify which ones are wrong, explain the correct solutions, and offer "
            "next steps or study tips tailored to their learning style.\n"
        )

    system_content += "If the user has other questions, do your best to help using the context.\n"

    messages = [{"role": "system", "content": system_content}] + session["conversation"]

    app.logger.info("=== Chat Endpoint Called ===")
    app.logger.info(f"System message length: {len(system_content)} characters")

    try:
        if len(session["conversation"]) <= 1 and diagnostic_test_text and test_answers:
            first_time_instruction = {
                "role": "user",
                "content": "Please analyze my diagnostic test results and provide feedback.",
            }
            messages.insert(1, first_time_instruction)

        response = openai.chat.completions.create(
            model="gpt-4o", messages=messages, temperature=0.7
        )

        if not response.choices:
            app.logger.error("No choices returned from OpenAI in chat")
            gpt_response = "[No content returned by OpenAI]"
        else:
            raw_content = response.choices[0].message.content or ""
            gpt_response = raw_content.strip()

        session["conversation"].append({"role": "assistant", "content": gpt_response})

        app.logger.info("=== OpenAI Chat Response ===")
        app.logger.info(gpt_response)

        return jsonify({"response": gpt_response})

    except Exception as e:
        app.logger.error(f"An error occurred in /chat: {e}")
        return jsonify({"error": str(e)}), 500


# ---------------- Utilities ----------------


@app.route("/clear_session", methods=["GET"])
def clear_session():
    """
    Simple endpoint to clear the session for a fresh start.
    """
    session.clear()
    return jsonify({"status": "session cleared"})


@app.route("/clear_conversation", methods=["POST"])
def clear_conversation():
    """
    Clear only the conversation history but keep diagnostic and learning style data
    """
    session["conversation"] = []
    return jsonify({"status": "conversation cleared, data preserved"})

@app.route("/recommend_videos", methods=["POST"])
def recommend_videos():
    """
    Return a JSON list of recommended videos.

    The payload may include:
        diagnostic_summary â€“ str
        learning_style     â€“ str
    If those are missing we fall back to whatever is in the session.
    """
    payload: Dict[str, Any] = request.get_json(silent=True) or {}
    diagnostic_summary: str = (
        payload.get("diagnostic_summary")
        or session.get("latest_diagnostic_analysis", "")
    )
    learning_style: str = (
        payload.get("learning_style")
        or session.get("primary_learning_style", "")
    )

    if not diagnostic_summary:
        # No context â†’ frontâ€‘end shows placeholder
        return jsonify({"videos": []})

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1.  Build search queries with GPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    prompt_template = _read_prompt_template("topic_prompts/video_topic_prompt.txt")
    user_prompt = prompt_template.format(
        weak_areas=diagnostic_summary.strip(),
        overall_subject="General curriculum",
    )

    try:
        app.logger.info("=== Generating search queries for videos ===")
        resp = openai.chat.completions.create(
            model="gpt-4o",
            messages=[
                {"role": "system", "content": "You are ScholarÂ AI Curator."},
                {"role": "user", "content": user_prompt},
            ],
            temperature=0.4,
            max_tokens=200,
        )
        raw = resp.choices[0].message.content if resp.choices else "[]"
        queries = _safe_json_loads(raw) or []
        if not isinstance(queries, list):
            queries = []
        app.logger.info("â€£ GPT search queries â†’ %s", queries)
    except Exception as exc:
        app.logger.error("LLM failed, fallback to generic query: %s", exc)
        queries = []

    # â”€â”€â”€â”€â”€â”€â”€ 2.  Use YouTube API â€”Â  â”€â”€â”€â”€â”€â”€â”€â”€
    videos: List[Dict[str, str]] = []
    seen: set[str] = set()

    for q in queries:
        for v in search_videos(q, max_results=5):
            if v["video_id"] in seen:
                continue
            seen.add(v["video_id"])
            videos.append(v)
            if len(videos) >= 8:
                break
        if len(videos) >= 8:
            break

    # If nothing came back, *just* return an empty list â€“ the UI will say so.
    app.logger.info("Videos selected: %s", [v["title"] for v in videos])
    return jsonify({"videos": videos})


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8080)
</file>

</files>
